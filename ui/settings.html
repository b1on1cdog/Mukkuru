<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Mukkuru - Settings</title>
    <link rel="stylesheet" href="./assets/css/settings.css">
    <script src="mukkuru.js"></script>
    <script src="localization.js"></script>
    <script>

//at this point we do not have access to userConfiguration, so we are using localStorage
if (localStorage.getItem("darkMode") == "true") {
    applyDarkMode();
}

//To-do: simplify function
function setDarkModeState(state){
    localStorage.setItem("darkMode", state);
   // document.getElementById(state?"darkMode":"lightMode").classList.add("checked");
   // document.getElementById(state?"lightMode":"darkMode").classList.remove("checked");
    document.getElementsByClassName("homeMenu")[0].style.setProperty("--bg-color", state?darkColor:lightColor);
    document.getElementsByClassName("controllerState-type")[0].getElementsByTagName("svg")[0].getElementsByTagName("path")[0].style.fill = state?lightColor:darkColor;
    document.querySelectorAll(".keyGuide-icon").forEach((element) => element.getElementsByTagName("path")[0].style.fill = state?lightColor:darkColor);
    const root = document.documentElement;
    root.style.setProperty('--description-color', state?'#A7C4D9':"rgba(39, 51, 67, 0.747)");
    document.getElementById("about-text").style.setProperty("color", getComputedStyle(root).getPropertyValue('--description-color').trim());
   // document.querySelectorAll(".option-description").forEach((element) => element.style.setProperty("color", state?"#A7C4D9":"rgba(39, 51, 67, 0.747)"));
    if (state == true){
        applyDarkMode();
    } else {
        document.documentElement.style.setProperty("--bg-color", lightColor);
        document.documentElement.style.setProperty("--main-color", darkColor);
    }
}

const SOURCE_OPTIONS = {
  STEAM:        1 << 0, // 1
  NONSTEAM:     1 << 1, // 2
  EGS:          1 << 2, // 4
};

let tabOptions = {};

const blistOptions = {
    "theme" : ["Switch", "Switch 2", "PS5"],
    "uiSounds" : ["Switch", "PS5"],
    "saveScreenshot" : ["Mukkuru", "User"]
}

function getSelectedOptions(bitmask) {
  return Object.entries(SOURCE_OPTIONS)
    .filter(([_, value]) => bitmask & value)
    .map(([name]) => name);
}

function updateLibraryOptions(){
    library_options = userConfiguration["librarySource"];
    Object.entries(SOURCE_OPTIONS).forEach(([key, bit], index) => {
    if (library_options & bit) {
        document.getElementById(`sources-${index}`)?.classList.add("checked");
    } else {
        document.getElementById(`sources-${index}`)?.classList.remove("checked");
    }
  });
}

function showPreviousSeparator(state){
    if (tabOptions[selectedTab][selectedOption].previousElementSibling != null && tabOptions[selectedTab][selectedOption].previousElementSibling.className == "option-separator") {
        tabOptions[selectedTab][selectedOption].previousElementSibling.style.display = state?"":"none";
    }
}

function showNextSeparator(state){
    if (tabOptions[selectedTab][selectedOption].nextElementSibling != null && tabOptions[selectedTab][selectedOption].nextElementSibling.className == "option-separator") {
        tabOptions[selectedTab][selectedOption].nextElementSibling.style.display = state?"":"none";
    }
}

function clearArtBlacklist(){
    userConfiguration["boxartBlacklist"] = [];
    userConfiguration["heroBlacklist"] = [];
    userConfiguration["logoBlacklist"] = [];
}

function deleteData(option){
    fetch("/clear/"+option, {
        method: "POST",
        headers: {
            "Content-type": "application/json; charset=UTF-8"
        }
    }).then((response) => { });
}

function checkSelectedTheme(theme){
    //elem.dataset.value
    themeTab = document.getElementById("options-3")
    themeOptions = themeTab.querySelectorAll(".menu-option")
    themeOptions.forEach((item) => {
        if (item.dataset.value == theme) {
            item.classList.add("checked")
        } else {
            item.classList.remove("checked")
        }
    });
}

function addUserThemes(){
    fetch("/themes/get").then(function(response) {
        return response.json();
    }).then(function(data) {
        //to-do: provide failover image as alt, to prevent empty image overlap
        if (!data) {
            backend_log("No user themes available")
            return
        }
        backend_log(JSON.stringify(data))
        themeTab = document.getElementById("options-3")
        Object.entries(data).forEach(([key, value]) => {
            theme = value;
            backend_log("adding "+key +" to themes list");
            const themeOption = document.createElement('div');
            themeOption.className = 'menu-option nospace';
            themeOption.id = key;
            themeOption.dataset.key = "theme";
            themeOption.dataset.value = key;
            themeOption.style.display = "flex";
            themeOption.style.alignItems = "center";

            const banner = document.createElement('img');
            banner.className = 'option-img';
            banner.src = "/theme/"+key+"/banner.png";
            banner.alt = theme.name;
            themeOption.appendChild(banner);
            themeOption.appendChild(document.createTextNode(theme.name))
            themeTab.appendChild(themeOption)
            const separator = document.createElement('div');
            separator.className = 'option-separator';
            themeTab.appendChild(separator)
            /*
            <div class="menu-option" id="sw_theme" data-key="theme" data-value="Switch" style="display: flex; align-items: center;">
                    <svg class="option-img" width="100" height="50" xmlns="http://www.w3.org/2000/svg">
                        <rect x="0" y="0" width="100" height="50" fill="white" stroke="black" stroke-width="2" rx="3" ry="3"></rect>
                    </svg>Sample
                    </div>
            
            
            */
        });//
        const spacer = document.createElement('div');
        spacer.style.minHeight = "300px";
        themeTab.appendChild(spacer)
        refreshOptions();
    });
}

function addUserAudios(){
    fetch("/audios/get").then(function(response) {
        return response.json();
    }).then(function(data) {
        backend_log("updating audios...");
        blistOptions.uiSounds = data;
        backend_log("new audios" + JSON.stringify(data));
    })
};

function refreshOptions() {
    document.querySelectorAll(".options").forEach((item, index) => {
        options = item.querySelectorAll(".menu-option");
        tabOptions[index] = options;
});
}

let aboutScreen = undefined;

/*
To-do: The vertical line must become cyan during dark mode
*/
document.addEventListener('DOMContentLoaded', () => {
const homeMenu = document.getElementsByClassName("homeMenu")[0];
const menuItems = document.querySelectorAll('.menu-tab');
const menuOptions = document.querySelectorAll('.menu-option');
//menuItems[0].className = "menu-tab selected";
menuItems[0].classList.add("selected");

if (isFirefox || isKioskMode) {
    document.getElementById("fullScreen").remove();
    document.getElementById("fullScreen-separator").remove();
}

fetch("/config/get").then(function(response) {
        return response.json();
    }).then(function(data) {
        userConfiguration = data;
        menuOptions.forEach(option => {
        if (option.innerHTML.includes("[BTOGGLE]")) {
            option.innerHTML = option.textContent.replace("[BTOGGLE]", `<span class="toggle-chars">${booleanTgl(userConfiguration[option.id])}</span>`  );
        } else if (option.innerHTML.includes("[BNUMBER]")) {
            option.innerHTML = option.textContent.replace("[BNUMBER]", `<span class="toggle-chars">${userConfiguration[option.id]}</span>`  );
        } else if (option.innerHTML.includes("[BLIST]")) {
            optionValue = userConfiguration[option.id];
            if (typeof optionValue == "number" && option.id in blistOptions) {
                optionValue = blistOptions[option.id][optionValue];
            }
            option.innerHTML = option.textContent.replace("[BLIST]", `<span class="toggle-chars">${optionValue}</span>`  );
        }
        document.getElementById("options-0").style.display = "";
});
        if (userConfiguration["darkMode"] == true) {
            setDarkModeState(true);
        } else {
            setDarkModeState(false);
            //localStorage.setItem("darkMode", false);
        }
        updateLibraryOptions();
        showKeyGuide(userConfiguration["showKeyGuide"]);
        refreshOptions();
        addUserThemes();
        addUserAudios();
        menuItems[0].scrollIntoView({ behavior: "instant", block: "center", inline: "nearest" });
        tabOptions[0][0].scrollIntoView({ behavior: "instant", block: "center", inline: "nearest" });
        allowRendering();
        setTimeout(function() { checkSelectedTheme(userConfiguration["theme"]); }, 300);
});    


fetch("/hardware").then(function(response) {
        return response.json();
    }).then(function(data) {
        hardwareInformation = data
        //archInfo = document.getElementById("arch");
        gpuInfo = document.getElementById("gpu_name");
        cpuInfo = document.getElementById("cpu_name");
        distroInfo = document.getElementById("distro");
        versionInfo = document.getElementById("app_version");
        try {
        document.getElementById("total_ram").innerText = "RAM: " + hardwareInformation["total_ram"] + "GiB";
        patchHTML("storage", "unknown", hardwareInformation["disk_total"] + "Gb");
        patchHTML("computer_name", "unknown", hardwareInformation["computer_name"]);
        cpu = hardwareInformation["cpu"];
        gpu = hardwareInformation["gpu"]
        cpu = cpu.replace(" Processor", "");
        cpuInfo.innerText = "CPU: " + cpu;
        gpuInfo.innerText = "GPU: " + gpu;
        if (gpu.includes("Unknown")) {
            gpuInfo.style.display = "none";
        }
        distroInfo.innerText = "OS: " + hardwareInformation["distro"];
        versionInfo.innerText = hardwareInformation["app_version"] + " (" + hardwareInformation["arch"] +")";
        } catch (err) {
            backend_log(err);
            gpuInfo.style.display = "none";
            distroInfo.style.display = "none";
        }
        if (hardwareInformation["has_battery"] == false) {    
            document.getElementById("displayBatteryPercent").remove();
            document.getElementById("dbp-separator").remove();
        }
        aboutId = "options-"+(Object.keys(tabOptions).length - 1);
        aboutScreen = document.getElementById(aboutId);
    });


selectedOption = 0;
selectedTab = 0;
lockedOption = false;

let isTab = true;

// Options optimization

const optionRangeMin = {
    "maxGamesInHomeScreen" : 6
}

const optionRangeMax = {
    "maxGamesInHomeScreen" : 24
}

//

function changeLockedValue(position) {
    elem = tabOptions[selectedTab][selectedOption];
    keyName = elem.id;
    value = userConfiguration[keyName];
    isList = typeof value == "number" && keyName in blistOptions;

    if (isList) {
        value = blistOptions[keyName][value];
    }

    prefix = "< ";
    postfix = " >";
    if (typeof(value) == 'number' ) {
    if (value+position == optionRangeMin[keyName]) {
        prefix = "";
    } else if (value+position == optionRangeMax[keyName]) {
        postfix = "";
    }

    if (position == 0) {
        lockedOption = !lockedOption;
        if (!lockedOption) {
            elem.querySelector('.toggle-chars').textContent = "" + value;
        } else {
            elem.querySelector('.toggle-chars').textContent = prefix + value + postfix;
        }
        return;
    }

        value = value+position;

        if (value < optionRangeMin[keyName] || value > optionRangeMax[keyName]){
            playSound("border");
            return;
        }

        userConfiguration[keyName] = value;
        elem.querySelector('.toggle-chars').textContent = prefix + value + postfix;
        playSound("tick");
    } else if (typeof value == "string") {
        current_position = blistOptions[keyName].indexOf(value);
        max_position = blistOptions[keyName].length - 1;
        if (current_position + position == 0) {
            prefix = "";
        } else if (current_position + position == max_position) {
            postfix = "";
        }
        if (position == 0) {
        
            lockedOption = !lockedOption;
            if (!lockedOption) {
                elem.querySelector('.toggle-chars').textContent = "" + value;
            } else {
                elem.querySelector('.toggle-chars').textContent = prefix + value + postfix;
            }
        return;
        }
        current_position = current_position + position;
        if (current_position < 0 || current_position > max_position) {
            playSound("border");
            return;
        }
        if (!isList) {
            value = blistOptions[keyName][current_position];
            userConfiguration[keyName] = value;
        } else {
            userConfiguration[keyName] = current_position;
            value = blistOptions[keyName][current_position];
        }

        elem.querySelector('.toggle-chars').textContent = prefix + value + postfix;
        playSound("tick");
    }
}

let licenses = {}

async function showLicense(licenseKey){
    console.log("displaying " + licenseKey+" license....");
    lastElement = (Object.keys(tabOptions).length - 1)
    aboutId = "options-"+lastElement;

    const licenseScreen = document.createElement("div");

    const licenseDescription = document.createElement("div");
    licenseDescription.className = "option-description";
    licenseDescription.innerText = licenses[licenseKey];
    licenseScreen.appendChild(licenseDescription);

    openNextPage(licenseScreen);
    isScrollable = true;
    scrollableItem = document.getElementsByClassName("menu-options")[0];
}
let previousPages = [];
let isScrollable = false;
let scrollableItem = null;

function openNextPage(newScreen){
    absoluteTab = document.getElementById("options-"+selectedTab);
    previousPages.push(absoluteTab.cloneNode(true));
    absoluteTab.replaceChildren(newScreen);
    //scrollIntoView({ behavior: "instant", block: "center", inline: "nearest" });
    refreshOptions();
}
function openPreviousPage(){
    absoluteTab = document.getElementById("options-"+selectedTab);
    const previousPage = previousPages.pop();
    absoluteTab.replaceChildren(...previousPage.childNodes);
    refreshOptions();
    isScrollable = false;
    selectedOption = 0;
    document.querySelectorAll(".menu-option.selected").forEach((element) => element.classList.remove("selected"));
    document.querySelectorAll(".option-separator").forEach((element) => element.style.display = "");
    if (!isTab){
        showPreviousSeparator(false);
        tabOptions[selectedTab][selectedOption].classList.add("selected");
        showNextSeparator(false);
    }
}

async function createLicenseScreen(){
    const response = await fetch("/license");
      if (!response.ok) {
        throw new Error(`HTTP ${response.status}`);
      }
    licenses = await response.json();
    const separator = document.createElement("div");
    separator.className = "option-separator";
    const licenseScreen = document.createElement("div");
    licenseScreen.appendChild(separator);
    for (const [key, value] of Object.entries(licenses)) {
        const m_option = document.createElement("div");
        m_option.className = "menu-option";
        m_option.innerText = key;
        m_option.dataset.call = "showLicense";
        m_option.dataset.param1 = key;
        licenseScreen.appendChild(m_option);
        licenseScreen.appendChild(separator.cloneNode(true));
    }
    const spacer = document.createElement('div');
    spacer.style.minHeight = "300px";
    licenseScreen.appendChild(spacer);

    openNextPage(licenseScreen);
}

document.addEventListener('keydown', (e) => {
    e.preventDefault();
    if (homeMenu.style.opacity < 1) {
        return;
    }
    ctxMenu = document.getElementsByClassName("contextualMenu active")[0];

        switch(keyBindings[e.key]) {
            case 'right':
                if (isContextMenu) {
                    return;
                }
                if (lockedOption) {
                    changeLockedValue(1);
                    break;
                }
                if (isTab == false || tabOptions[selectedTab].length == 0) {
                    playSound("border");
                    break;
                }
                isTab = false;
                tabOptions[selectedTab][selectedOption].classList.add("selected");
                menuItems[selectedTab].className = "menu-tab marked";
                showPreviousSeparator(false);
                showNextSeparator(false);
                playSound("select");
                break;
            
            case 'confirm':
            if (isContextMenu) {
                selectedContext = ctxMenu.getElementsByClassName("contextItem selected")[0];
                selectedContext.click();
                playSound("tick");
                return;
            }
            if (isTab) {
                playSound("select");
                //Trigger ArrowRight
                break;
            }
            playSound("tick");
            elem = tabOptions[selectedTab][selectedOption];
                //elem = tabOptions[selectedTab][selectedOption];
            if (elem.dataset.hasOwnProperty("call")) {
                    switch (elem.dataset.call) {
                        case "deleteArt":
                            deleteData("art");
                            break;
                        case "deleteData":
                            deleteData("all");
                            break;
                        case "moveDownloads":
                            move_files("misc");
                            break;
                        case "clearArtBlacklist":
                            clearArtBlacklist();
                            break;
                        case "createLicenseScreen":
                            createLicenseScreen();
                            break;
                        case "showLicense":
                            showLicense(elem.dataset.param1);
                            break;
                        case "updateMukkuru":
                            updateMukkuru();
                            break;
                        case "click":
                            elem.click();
                            break;
                        default:
                            break;
                    }
                } else if (elem.dataset.hasOwnProperty("key")) {
                if (elem.dataset.value == "true" || elem.dataset.value == "false") {
                    tstate = (elem.dataset.value == "true");
                    userConfiguration[elem.dataset.key] = tstate;
                } else if (elem.dataset.hasOwnProperty("flip")) {
                    userConfiguration[elem.dataset.key] ^= SOURCE_OPTIONS[elem.dataset.flip];
                    updateLibraryOptions();
                }  else {
                    if (elem.dataset.key == "theme") {
                        checkSelectedTheme(elem.dataset.value)
                    }
                    userConfiguration[elem.dataset.key] = elem.dataset.value;
                }
                    

            } else {
                let elem_id = tabOptions[selectedTab][selectedOption].id
                let value = userConfiguration[elem_id];
                if (typeof value === 'boolean') {
                    tabOptions[selectedTab][selectedOption].innerHTML = (tabOptions[selectedTab][selectedOption].innerHTML).replace(booleanTgl(value), booleanTgl(!value));
                    userConfiguration[elem_id] = !value;
                    if (elem_id == "darkMode") {
                        setDarkModeState(!value)
                    }
                } else if (typeof value === 'number') {
                    changeLockedValue(0);
                } else if (typeof value === 'string') {
                    changeLockedValue(0);
                }
        }

            setTimeout(() => {
            fetch("/config/set", {
                    method: "POST",
                    body: JSON.stringify(userConfiguration),
                    headers: {
                        "Content-type": "application/json; charset=UTF-8"
                    }
                }).then((response) => {

                    if (elem != undefined && elem != null) {
                        if (elem.dataset.key == "language") {
                            allowRendering(true);
                            backend_log("apply language....");
                        }
                    }
                });
                }, "50");
            
            break;

            case 'left':
                if (isContextMenu) {
                    return;
                }
                if (isTab) {
                    playSound("border");
                    break;
                }
                if (lockedOption) {
                    changeLockedValue(-1);
                    break;
                }
                isTab = true;
                //menuItems[selectedTab].className = "menu-tab selected";
                menuItems[selectedTab].classList.add("selected");
                tabOptions[selectedTab].forEach((item) => {
                    //item.className = "menu-option";
                    item.classList.remove("selected");
                });
                currentOption = tabOptions[selectedTab][selectedOption];
                if (currentOption != null) {
                    showPreviousSeparator(true);
                    showNextSeparator(true);
                }
                playSound("select");
                break;
            
            case 'up':
                 if (isContextMenu) {
                    return;
                }
                if (lockedOption) {
                    changeLockedValue(0);
                }
                if (isTab){
                if (selectedTab == 0) {
                    playSound("border");
                    break;
                }
                while (previousPages.length > 0) {
                    openPreviousPage();
                }
                menuItems[selectedTab].className = "menu-tab";
                selectedTab--;
                menuItems[selectedTab].className = "menu-tab selected";
                menuItems[selectedTab].scrollIntoView({ behavior: "instant", block: "center", inline: "nearest" });
                selectedOption = 0;
            } else {
                if (isScrollable) {
                    scrollableItem.scrollBy(0, -100);
                    return;
                }

                if (selectedOption == 0)
                {
                    playSound("border");
                    break;
                }
                showPreviousSeparator(true);
                showNextSeparator(true);
                tabOptions[selectedTab][selectedOption].classList.remove("selected");
                tabOptions[selectedTab][selectedOption].scrollIntoView({ behavior: "instant", block: "center", inline: "nearest" });
                selectedOption--;
                tabOptions[selectedTab][selectedOption].classList.add("selected");
                showPreviousSeparator(false);
                showNextSeparator(false);
            }
                playSound("select");
                break;
            case 'down':
                if (isContextMenu) {
                    return;
                }
                if (lockedOption) {
                    changeLockedValue(0);
                }
                if (isTab){

                if (selectedTab == menuItems.length - 1) {
                    playSound("border");
                    break;
                }
                while (previousPages.length > 0) {
                    openPreviousPage();
                }
                
                menuItems[selectedTab].className = "menu-tab";
               // menuItems[selectedTab].classList.remove("selected");
                selectedTab++;
                //menuItems[selectedTab].classList.add("selected");
                menuItems[selectedTab].className = "menu-tab selected";
                menuItems[selectedTab].scrollIntoView({ behavior: "instant", block: "center", inline: "nearest" });
                selectedOption = 0;
            } else {

                if (isScrollable) {
                    scrollableItem.scrollBy(0, 100);
                    return;
                }

                if (selectedOption+1 == tabOptions[selectedTab].length)
                {
                    playSound("border");
                    break;
                }
                    currentOption = tabOptions[selectedTab][selectedOption];
                    if (currentOption == null) {
                        playSound("border");
                        return;
                    }
                    showPreviousSeparator(true);
                    showNextSeparator(true);
                    tabOptions[selectedTab][selectedOption].classList.remove("selected");
                    selectedOption++;
                    tabOptions[selectedTab][selectedOption].classList.add("selected");
                    tabOptions[selectedTab][selectedOption].scrollIntoView({ behavior: "instant", block: "center" });
                    showPreviousSeparator(false);
                    showNextSeparator(false);
            }
                playSound("select");
                break;
            case 'back':
                if (isContextMenu) {
                    close_context_menu();
                    return;
                }
                //tabOptions[selectedTab].getElementsByClassName("parent")
                if (previousPages.length > 0) {
                    playSound("enter-back");
                    openPreviousPage();
                    return;
                }
                goHome();
                break;
            default:
                break;
        }
        document.querySelectorAll(".options").forEach((item) => {
            item.style.display = "none";
        });
        document.getElementById(`options-${selectedTab}`).style.display = "";
});
});   

</script>
</head>
<body>
    <article class="homeMenu pending">
        <div class="settings-container">
            <div class="header">
                <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><path d="M83.285,52.4V46.9H73.1a23.155,23.155,0,0,0-4.83-11.633l7.208-7.209-3.888-3.888-7.209,7.208a23.155,23.155,0,0,0-11.633-4.83V16.361h-5.5V26.544a23.155,23.155,0,0,0-11.633,4.83l-7.209-7.208L24.52,28.054l7.208,7.209A23.155,23.155,0,0,0,26.9,46.9H16.715v5.5H26.9a23.157,23.157,0,0,0,4.829,11.633L24.52,71.237l3.888,3.889,7.209-7.209a23.146,23.146,0,0,0,11.633,4.83V82.931h5.5V72.747a23.146,23.146,0,0,0,11.633-4.83l7.209,7.209,3.888-3.889-7.208-7.208A23.157,23.157,0,0,0,73.1,52.4ZM50,67.415A17.77,17.77,0,1,1,67.77,49.646,17.79,17.79,0,0,1,50,67.415Z" fill="#707676"/></svg>
                <h2 id="settings-header">System Settings</h2>
            </div>
            <div class="separator"></div>
        </div>
        <main class="settings-body">
            
            <div class="menu">
                <div id="sourcesTab" data-loc="LibrarySources" data-trm="swapText" class="menu-tab">Sources</div>
                <div id="libraryTab" class="menu-tab" data-loc="Library" data-trm="swapText">Library</div>
                <div id="navigationTab" class="menu-tab" data-loc="Navigation" data-trm="swapText">Navigation</div>
                <div id="themesTab" class="menu-tab" data-loc="Themes" data-trm="swapText">Themes</div>
                <div id="languageTab" class="menu-tab" data-loc="Language" data-trm="swapText">Language</div>
                <div class="separator"></div>
                <div id="advancedTab" class="menu-tab" data-loc="Advanced" data-trm="swapText">Advanced</div>
                <div class="separator"></div>
                <div id="aboutTab" class="menu-tab" data-loc="About" data-trm="swapText">About</div>
            </div>

            <div class="menu-options">
                <div class="options" id="options-0" style="display:none;">
                    <div class="option-description" id="librarySource-desc">Services chosen here will be used as library provider</div>
                    <div class="option-separator"></div>
                    <div class="menu-option" id="sources-0" data-key="librarySource" data-flip="STEAM">Steam</div>
                    <div class="option-separator"></div>
                    <div class="menu-option" id="sources-1" data-key="librarySource" data-flip="NONSTEAM">Non-Steam</div>
                    <div class="option-separator"></div>
                    <div class="menu-option" id="sources-2" data-key="librarySource" data-flip="EGS">EGS</div>
                    <div class="option-separator"></div>
                </div>
                <div class="options" id="options-1" style="display:none;">
                    <div class="option-separator"></div>
                    <div class="menu-option" id="skipNoArt" data-trm="swapTGL" data-loc="id">Skip apps without art [BTOGGLE]</div>
                    <div class="option-separator"></div>
                    <div class="menu-option" id="maxGamesInHomeScreen" data-loc="id" data-trm="swapTGL">Max games to display [BNUMBER]</div>
                    <div class="option-separator"></div>
                    <div class="option-description" id="maxGamesInHomeScreen-desc" data-loc="id" data-trm="swapText">Number of games to show in Homescreen, additional ones can be accesed from "All Software" button</div>

                    <div class="option-separator"></div>
                    <div class="menu-option" id="startupGameScan" data-trm="swapTGL" data-loc="id">Scan games at startup[BTOGGLE]</div>
                    <div class="option-separator"></div>
                    <div class="option-description" id="startupGameScan-desc" data-trm="swapTGL" data-loc="id">Scan games automatically everytime Mukkuru opens</div>

                </div>
                <div class="options" id="options-2" style="display:none;">
                    <div class="option-separator" id="fullScreen-separator"></div>
                    <div class="menu-option" id="fullScreen" data-trm="swapTGL" data-loc="fullScreen">Use Fullscreen [BTOGGLE]</div>
                    <div class="option-separator"></div>
                    <div class="menu-option" id="loop" data-trm="swapTGL" data-loc="loop">Cursor loop effect [BTOGGLE]</div>
                    <div class="option-separator"></div>
                    <div class="option-description" id="loop-desc" data-trm="swapText" data-loc="loop-desc">Return cursor from the other side of the screen when navigating</div>
                    <div class="option-separator"></div>
                    <div class="menu-option" id="showKeyGuide" data-trm="swapTGL" data-loc="id">Show keyGuide bar [BTOGGLE]</div>
                    <div class="option-separator"></div>
                    <div class="menu-option" id="uiSounds" data-trm="swapTGL" data-loc="id">Sound effects [BLIST]</div>
                    <div class="option-separator" id="dbp-separator"></div>
                    <div class="menu-option" id="displayBatteryPercent" data-trm="swapTGL" data-loc="id">Display battery percent [BTOGGLE]</div>
                    <div class="option-separator"></div>
                    <div class="spacer" style="min-height:300px"></div>
                </div>
                <div class="options" id="options-3" style="display:none; ">
                    <div class="option-separator"></div>
                    <div class="menu-option" id="darkMode" data-trm="swapTGL" data-loc="id">Dark Mode &nbsp; [BTOGGLE]</div>
                    <div class="option-separator"></div>
                    <div class="menu-option nospace" id="sw_theme" data-key="theme" data-value="Switch" style="display: flex; align-items: center;">
                    <svg class="option-img" width="100" height="50" xmlns="http://www.w3.org/2000/svg">
                        <rect x="0" y="0" width="100" height="50" fill="white" stroke="black" stroke-width="2" rx="3" ry="3"></rect>
                    </svg>Switch
                    </div>
                    <div class="option-separator"></div>
                    <div class="menu-option nospace" id="sw2_theme" data-key="theme" data-value="Switch 2" style="display: flex; align-items: center;">
                    <svg class="option-img" width="100" height="50" xmlns="http://www.w3.org/2000/svg">
                        <rect x="0" y="0" width="100" height="50" fill="purple" stroke="black" stroke-width="2" rx="3" ry="3"></rect>
                    </svg>Switch 2
                    </div>
                     <div class="option-separator"></div>
                    <div class="menu-option nospace" id="ps5_theme" data-key="theme" data-value="PS5" style="display: flex; align-items: center;">
                    <svg class="option-img" width="100" height="50" xmlns="http://www.w3.org/2000/svg">
                        <rect x="0" y="0" width="100" height="50" fill="black" stroke="black" stroke-width="2" rx="3" ry="3"></rect>
                    </svg>PS5
                    </div>
                    <div class="option-separator"></div>

                </div>
                <div class="options" id="options-4" style="display:none;">
                    <div class="option-separator"></div>
                    <div class="menu-option" id="12H" data-trm="swapTGL" data-loc="id">Use 12-Hour Time [BTOGGLE]</div>
                    <div class="option-separator"></div>
                    <br>
                    <div class="option-separator"></div>
                    <div class="menu-option" id="EnglishLang" data-loc="EnglishLang" data-trm="swapText" data-key="language" data-value="EN">English</div>
                    <div class="option-separator"></div>
                    <div class="menu-option" id="SpanishLang" data-loc="SpanishLang" data-trm="swapText" data-key="language" data-value="ES">Spanish</div>
                    <div class="option-separator"></div>
                </div>
                <div class="options" id="options-5" style="display:none;">
                    <div class="option-separator"></div>
                    <div class="menu-option" id="saveScreenshot" data-loc="id" data-trm="swapTGL">Screenshot destination [BLIST]</div>
                    <div class="option-separator"></div>
                    <div class="option-description" id="data-folder-desc" data-trm="swapText" data-loc="id">"Mukkuru" means Mukkuru data folder<br>"User" references a folder in home directory</div>

                    <div class="option-separator"></div>
                    <div class="menu-option" id="useAllVideoSources" data-loc="id" data-trm="swapTGL">Use all video sources [BTOGGLE]</div>
                    <div class="option-separator"></div>
                    <div class="option-description" id="all-videos-sources-desc" data-trm="swapText" data-loc="id">Reads videos from user video folder</div>
                    
                    <div class="option-separator"></div>
                    <div class="menu-option" id="moveDownloads" data-loc="id" data-trm="swapTGL" data-call="moveDownloads">Move files to Downloads</div>
                    <div class="option-separator"></div>
                    <div class="option-description" id="move-downloads-desc" data-trm="swapText" data-loc="id">Moves files from Mukkuru Data to Downloads folder (Media files are excluded)</div>

                    <div class="option-separator"></div>
                    <div class="menu-option" id="clearArtBlacklist" data-loc="id" data-trm="swapText" data-call="clearArtBlacklist">Clear art blacklist</div>
                    <div class="option-separator"></div>
                    <div class="option-description" id="clear-blacklist-desc" data-trm="swapText" data-loc="id">Allows to retry download of arts marked as unavailable</div>

                    <div class="option-separator"></div>
                    <div class="menu-option" id="clearArt" data-loc="clearArt" data-trm="swapText" data-call="deleteArt">Clear downloaded art</div>
                    <div class="option-separator"></div>

                    <div class="menu-option" id="clearData" data-loc="clearData" data-trm="swapText" data-call="deleteData">Wipe Mukkuru data</div>
                    <div class="option-separator"></div>
                    <div class="spacer" style="min-height:150px"></div>
                </div>
                <div class="options" id="options-6" style="display:none;">
                    <div class="option-separator"></div>
                    <div class="menu-option" id="updateMukkuru" data-loc="id" data-trm="swapText" data-call="updateMukkuru">Update</div>
                    <div class="option-separator"></div>

                    <div id="about-text" class="option-description" style="font-size: 28px;color: rgba(30, 39, 50, 0.747)">
                    <div id="computer_name" data-loc="Name" data-trm="patchHTML" data-patch="Name">Name: unknown</div>
                    <div id="distro">OS: unknown</div>
                    <div id="cpu_name">CPU: unknown</div>
                    <div id="gpu_name">GPU: unknown</div>
                    <div id="total_ram">RAM: unknown</div>
                    <div id="storage" data-loc="storage" data-trm="patchHTML" data-patch="Storage">Storage: unknown</div>
                    <br>
                    <div id="app_version">Crash loading hardware info</div>
                    <div>Made with ♥ by b1on1cdog</div>
                    <div>https://github.com/b1on1cdog/mukkuru</div>
                    </div>
                    <div class="option-separator"></div>
                    <div class="menu-option" id="showLicenses" data-loc="id" data-trm="swapText" data-call="createLicenseScreen">License</div>
                    <div class="option-separator"></div>
                </div>
            </div>

            </div>
        </main>
        <div class="contextualMenu" id="messageContext" style="opacity: 0.9;">
            <div id="messageBox"style="margin: 50px 50px 50px 50px">There's nothing to display here</div>
            <div class="contextItem selected" id="messageAccept" onclick='close_context_menu(false)'>Confirm</div>
        </div>
        <footer class="homeFooter">
            <div class="controllerState">
                <div class="controllerState-type">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 184.689 100"><path d="M158 14.466H26.692a16.047 16.047 0 0 0-16 16v39.068a16.047 16.047 0 0 0 16 16H158a16.047 16.047 0 0 0 16-16V30.466a16.047 16.047 0 0 0-16-16zm.8 10.31a3.359 3.359 0 1 1-3.359 3.358 3.357 3.357 0 0 1 3.359-3.358zm0 13.969a3.359 3.359 0 1 1-3.36 3.355 3.358 3.358 0 0 1 3.36-3.355zM26.691 26.786a6.177 6.177 0 1 1-6.177 6.177 6.177 6.177 0 0 1 6.177-6.177zm-7.263 33.04a3.359 3.359 0 1 1 3.359-3.358 3.358 3.358 0 0 1-3.359 3.358zm7.263 7.253a3.359 3.359 0 1 1 3.358-3.359 3.359 3.359 0 0 1-3.358 3.359zm0-13.97a3.359 3.359 0 1 1 3.358-3.358 3.359 3.359 0 0 1-3.358 3.358zm7.109 6.717a3.359 3.359 0 1 1 3.358-3.358 3.359 3.359 0 0 1-3.358 3.358zm105.42 17.14H43.958v-52.19h95.262zm9.108-41.579a3.359 3.359 0 1 1 3.358 3.358 3.358 3.358 0 0 1-3.358-3.358zM158.8 65.068a6.177 6.177 0 1 1 6.177-6.177 6.177 6.177 0 0 1-6.177 6.177zm7.263-26.323a3.359 3.359 0 1 1 3.358-3.358 3.359 3.359 0 0 1-3.359 3.358z" fill="2E2E2E"/></svg>
                </div>
            </div>
            <div class="keyGuideList pending">
                <div class="keyGuide" id="back-keyGuide">
                    <svg class="keyGuide-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><path d="M59.765 57.536a5.611 5.611 0 0 1-.821 3.15 6.024 6.024 0 0 1-2.171 1.985 9.644 9.644 0 0 1-3.016 1.029 19.232 19.232 0 0 1-3.309.291h-6.564V51.237h7.041a12.05 12.05 0 0 1 6.563 1.482 5.319 5.319 0 0 1 2.277 4.817zm-6.22-11.09a7 7 0 0 0 2.355-1.058 5.194 5.194 0 0 0 1.588-1.8 5.473 5.473 0 0 0 .582-2.62 4.6 4.6 0 0 0-2.222-4.315 11.857 11.857 0 0 0-5.982-1.3h-5.982v11.438h6.829a11.355 11.355 0 0 0 2.832-.345zM83.285 50A33.285 33.285 0 1 1 50 16.715 33.285 33.285 0 0 1 83.285 50zm-18.227 7.8a9.861 9.861 0 0 0-.609-3.547 8.167 8.167 0 0 0-1.72-2.752 8.707 8.707 0 0 0-2.647-1.88 10.89 10.89 0 0 0-3.335-.926v-.105a9.181 9.181 0 0 0 4.765-2.911 7.815 7.815 0 0 0 1.8-5.241 8.939 8.939 0 0 0-1.033-4.5 8.572 8.572 0 0 0-2.7-2.912 11.221 11.221 0 0 0-3.779-1.587 19.281 19.281 0 0 0-4.235-.475H38.644V68.44h12.334a21.8 21.8 0 0 0 5.478-.662 14.093 14.093 0 0 0 4.473-1.958 9.277 9.277 0 0 0 4.129-8.02z" fill="2e2e2e"/></svg>
                    <div id="back-keyText" class="keyGuide-text">
                        Back
                    </div>
                </div>
                <div class="keyGuide">
                    <svg class="keyGuide-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><path d="M49.83,36.051l6.987,17.574H42.79ZM83.285,50A33.285,33.285,0,1,1,50,16.715,33.285,33.285,0,0,1,83.285,50ZM68.463,67.44,52.371,29.964H47.607L31.356,67.44h5.823l3.759-9.211H58.724l3.81,9.211Z" fill="2E2E2E"/></svg>
                    <div id="ok-keyGuide" class="keyGuide-text">
                        OK
                    </div>
                </div>
            </div>
        </footer>
    </div>
</body>
</html>